import{aV as x,ds as E,dt as L,aQ as $,ae as D,ap as u,aG as r,aw as d,ax as m,af as s,az as S,aA as l,G as c,du as N,aI as p,ch as b,ci as _,as as g,ay as U,aC as B,an as w,aJ as G,T as V,i as M,a$ as Q,aZ as q,a_ as O,r as R,g as K,am as W,dv as J,aE as j,av as z}from"./_virtual_wxt-plugins-B1XNwc1o.js";import{s as H}from"./messaging-Cy88Lnqw.js";import{u as Z}from"./useMutation-D50M5xoC.js";import{_ as X}from"./PlatformIcon.vue_vue_type_script_setup_true_lang-BmQefwBM.js";import{a as C,u as Y,_ as ee}from"./useDevicesQuery-9UTQhUak.js";import{b as te}from"./useConfirmationStore-C6tO7gb_.js";import{u as se,a as T,s as ae,b as ne,_ as oe}from"./stayfree-pairing-track-cross-devices-h6jZI58U.js";import{_ as ie}from"./HeaderItem-Dalei1GI.js";import{P as re}from"./plus-C0pfZQdr.js";import"./tailwind-BONbPHxB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ce(){return x(E(L.SessionsLastUploadedAt,{fallback:null}))}function le(){const o=$();return Z({mutationFn:async()=>{await o.usage.uploadAll()}})}const ue={class:"flex gap-3"},me={key:0,class:"text-sm"},pe=D({__name:"UsageLastSynced",setup(o){const{mutate:i}=le(),{state:a}=ce();function n(){i(),H("clear-cache",!0)}return(t,e)=>(r(),u("div",ue,[s(a)?(r(),u("p",me,[S(l(("t"in t?t.t:s(c))("usageLastSynced"))+" ",1),m("span",null,l(("formatTimeAsTimeOfDay"in t?t.formatTimeAsTimeOfDay:s(N))(s(a))),1)])):d("",!0),m("a",{class:"text-sm link link-hover link-primary",onClick:n},l(("t"in t?t.t:s(c))("syncNow"))+"?",1)]))}}),de={class:"group flex items-center space-x-4 px-4 py-2 rounded-lg hover:ring-1 hover:ring-base-content hover:ring-opacity-15"},_e={class:"flex flex-col flex-grow"},ve={class:"text-base-content text-lg"},ye={key:0,class:"text-xs uppercase py-0.5 px-1 ml-2 rounded-sm font-bold bg-primary text-primary-content"},fe={class:"text-base-content text-opacity-secondary font-mono pb-1 text-sm"},ge=D({name:"DeviceListItem",__name:"DeviceListItem",props:{name:{},installId:{},isCurrentDevice:{type:Boolean}},emits:["remove"],setup(o,{emit:i}){const a=o,n=i;function t(){n("remove",a.installId)}return(e,h)=>(r(),u("div",de,[p(X,{class:"icon opacity-icon shrink-0",platform:e.name,"show-extension-icon":!0},null,8,["platform"]),m("div",_e,[m("p",ve,[m("span",null,l(e.name.trim()||("t"in e?e.t:s(c))("unknownDeviceName")),1),e.isCurrentDevice?(r(),u("span",ye,l(("t"in e?e.t:s(c))("thisDevice")),1)):d("",!0)]),m("p",fe,l(e.installId),1)]),e.isCurrentDevice?(r(),u("button",{key:0,class:"btn btn-outline btn-error btn-sm mt-3 not-prose float-right uppercase m-auto",onClick:t},l(("t"in e?e.t:s(c))("unlink")),1)):d("",!0)]))}}),De={key:0,class:"mt-3"},he=D({__name:"DeviceList",setup(o){const i=C(),{deviceGroup:a}=b(_()),{kickedFromGroup:n,removeDevice:t}=_(),{devices:e,isFetching:h,isError:k}=Y(a),v=te();async function I(y){v.show({title:c("genericConfirmation"),message:c("removeDeviceConfirmationMessage"),positiveButtonText:c("unlink"),destructive:!0,async onClickPositive(){return await t({installIdToRemove:y,deviceGroupKey:a.value.key}),y==i.value&&await n(),!0},negativeButtonText:c("cancel")})}return(y,Ge)=>{const P=ee,A=ge,F=pe;return s(k)?d("",!0):(r(),u("div",De,[s(h)?(r(),g(P,{key:0})):(r(!0),u(U,{key:1},B(s(e),f=>(r(),g(A,{key:f.install_id,name:f.name,"install-id":f.install_id,"is-current-device":s(i)===f.install_id,onRemove:I},null,8,["name","install-id","is-current-device"]))),128)),s(a)?(r(),g(F,{key:2,class:"mt-2"})):d("",!0)]))}}});function ke(o){const{deviceGroup:i}=b(_()),{setDeviceGroup:a}=_(),n=se(),t=T();w(o,async e=>{e&&!i.value&&(await a(e),t.hide(),n.show({}),G.track("SUCCESSFUL_PAIRING_DEVICE"))})}function Ie(){const o=V.Second*3,i=M(),a=R(),n=C(),t=Q(async()=>await a.canUploadData()&&!!n.value);return q({queryKey:[O.DeviceGroup],queryFn:async()=>await i.getMyDeviceGroup({installId:await K()}).catch(()=>null)??null,enabled:t.value,staleTime:o,refetchInterval:o})}function Se(){const{deviceGroup:o}=b(_()),{kickedFromGroup:i}=_(),{data:a}=Ie();let n=W();return n=a,w(a,async t=>{o.value&&(n.value=o.value),t==null?(J("[Device group] The current device was kicked from group"),await i(),n.value=null):(o.value==null||o.value.key!==t.key)&&(n.value=t)}),{remoteDeviceGroup:n}}const be={class:"flex flex-col"},we={key:0},Be=D({__name:"stayfree-pairing",setup(o){const i=T(),a=[{src:ae,title:c("pairingPromo_sharedUsageLimit")},{src:ne,title:c("pairingPromo_trackAcrossAllDevices")}];function n(){i.show({}),G.track("SHOW_PAIRING_DEVICE_VIEW")}const{remoteDeviceGroup:t}=Se();return ke(t),(e,h)=>{const k=ie,v=j("i18n-t"),I=oe,y=he;return r(),u("div",be,[p(k,null,{default:z(()=>[S(l(("t"in e?e.t:s(c))("stayFreePairing")),1)]),_:1}),s(t)?d("",!0):(r(),u("div",we,[p(v,{tag:"div","key-value":"stayFreePairingDescription",class:"text-base-content"}),p(v,{tag:"div","key-value":"stayFreePairingFeatures",class:"mt-4 text-base-content"}),p(v,{tag:"div","key-value":"installStayFree",class:"mt-4 text-base-content"}),p(I,{images:a})])),s(t)?(r(),g(y,{key:1})):d("",!0),m("div",null,[m("button",{class:"btn btn-sm mt-2 btn-primary uppercase text-ellipsis",onClick:n,"data-testid":"open-pairing-dialog"},[p(s(re),{class:"h-5 w-5 shrink-0 inline"}),S(" "+l(("t"in e?e.t:s(c))("pairing_pairNewDevice")),1)])])])}}});export{Be as default};
