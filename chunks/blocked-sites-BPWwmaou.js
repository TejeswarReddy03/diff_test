import{u as De,b as Fe,_ as re,c as We,a as Ne}from"./useAddGroupDialogStore-DSzMTqXn.js";import{_ as te}from"./Alert.vue_vue_type_script_setup_true_lang-DgaHjpj3.js";import{aQ as Y,cg as se,a_ as R,C as N,a4 as ue,d4 as $e,aZ as de,y as Oe,G as t,T as L,L as Ue,aj as d,aN as xe,d5 as ne,ae as ie,ch as qe,ci as Re,am as W,ap as T,aG as p,ax as n,as as V,aw as G,aI as D,aO as x,aA as c,af as a,av as K,az as q,ay as Q,aC as ce,aJ as me,aV as pe,d6 as ve,an as Ve,aP as je,d7 as ee,aM as He,aq as Ke}from"./_virtual_wxt-plugins-CgS_BGdF.js";import{u as ae}from"./useMutation-BhQfRMH1.js";import{p as fe}from"./immer-CwDZyRGJ.js";import{d as be,b as H}from"./tailwind-C6GlUj0q.js";import{C as Pe}from"./close-BfE11LHo.js";import{P as Qe}from"./plus-B3tHi6up.js";import{B as Ye}from"./bin-D3kJEuLM.js";import{_ as ze}from"./SfFavicon.vue_vue_type_script_setup_true_lang-BqcD5SEv.js";import{u as Ze}from"./options-CWXM4w2v.js";import{b as Je}from"./useConfirmationStore-CrGQIQTN.js";import{u as he}from"./useChallengeStore-Bddti5TS.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Xe}from"./useGetNuclearTimerQuery-CbANNXdz.js";import{u as et}from"./useAddTimerMutation-B4SmRH-b.js";import{_ as tt}from"./HeaderItem-B9YPjTpp.js";import"./PlatformIcon.vue_vue_type_script_setup_true_lang-BltirQPY.js";function st(){const o=Y(),s=se();return ae({mutationFn:async({timerId:l,type:v,name:h,allowedTimeInMs:i,blocklist:g,isEnabled:B,brandIds:M})=>{const r=await o.timers.getTimerById(l);if(r){const $=r.timer,f=fe($,_=>{_.allowedTimeMs=i,_.blocklist=g,_.brandIds=M,_.name=h,_.isEnabled=B});v==N.Group&&f.isSynced&&await ue().addGenericUsageLimit($e(f)),await o.timers.upsertTimer(f)}},onSuccess:()=>{s.invalidateQueries({queryKey:[R.GetTimersForGroups]})}})}function ye(){const o=Y(),s=se();return ae({mutationFn:async({timerId:l,type:v})=>{v==N.Group?await ue().removeGenericUsageLimit(l):await o.timers.deleteTimer(l)},onSuccess:()=>{s.invalidateQueries({queryKey:[R.GetTimersForGroups]}),s.invalidateQueries({queryKey:[R.GetTimerForBlockAll]}),s.invalidateQueries({queryKey:[R.GetNuclearTimer]})}})}function nt(){return de({queryKey:[R.GetAppGroups],queryFn:()=>Oe(),refetchOnMount:!0,refetchOnReconnect:!0,refetchOnWindowFocus:!0})}function Te(o,s,l,v=!1){const h=o-s;let i=!0;if(l==0&&v)return alert(t("cannotSetTimeToZero")),!1;if(l>=L.Day)return alert(t("cannotSetMoreThan1440Mins")),!1;if(l<0)return alert(t("cannotSetTimeToZeroOrLess")),!1;if(s>=l&&(i=confirm(t("allSitesBlockedImmediately")),!i))return!1;if(l>o&&(h<180?(i=confirm(t("lessThanThreeMins")),i===!0&&(i=confirm(t("lessThanThreeMins2"))),i===!0&&(i=confirm(t("lessThanThreeMins3"))),i===!0&&(i=confirm(t("lessThanThreeMins4"))),i===!0&&(i=confirm(t("lessThanThreeMins5"))),i===!0&&(i=confirm(t("lessThanThreeMins6"))),i===!0&&(i=confirm(t("lessThanThreeMins7"))),i===!0&&(i=confirm(t("lessThanThreeMins8"))),i===!0&&(alert(t("tellingYourMom")),window.open(Ue.Procrastination))):(i=confirm(t("maybeYouShouldReconsider")),i===!0&&(i=confirm(t("onlyHurtingYourself"))),i===!0&&alert(t("meow")))),i===!0){let g=t("settingsUpdated");l<o&&(g=t("givingLessTime")+`

`+g),alert(g)}return i}function it(o){const s=d(()=>o.customLimitName==xe),l=d(()=>o.timeLeftMs<L.Second),v=d(()=>{const i=ne(o.dailyLimitDuration);return{hours:i.hours,minutes:i.minutes}}),h=d(()=>o.timeLeftMs<L.Second?1:o.timeLeftMs);return{isDefaultGroup:s,isTimeExpired:l,parsedAllowedTime:v,timeLeft:h}}const at=["data-testid"],ot={class:"flex flex-row p-3"},lt={class:"text-center min-w-24"},rt={key:0,class:"mt-6"},ut={class:"text-xs align-super ml-1"},dt={class:"grow m-auto"},ct={class:"p-3 join w-full items-center"},mt={class:"join-item bg-neutral padding-inherit"},pt={class:"w-full"},vt=["disabled","placeholder"],ft={class:"ps-3"},bt={class:"inline-block whitespace-nowrap"},ht={class:"join"},_t={class:"ml-3"},yt=["disabled"],Tt={class:"rounded-none mx-2"},gt=["disabled"],wt={class:"rounded-none mx-2"},kt=["disabled"],St={class:"p-3 border-t border-t-neutral"},At={class:"w-full flex justify-between items-center gap-4"},Gt={class:"text-sm grow font-bold whitespace-nowrap uppercase"},Mt={class:"w-full not-prose"},Bt={class:"list-none",name:"blockedWebsites"},Et={class:"flex justify-start items-center"},Ct=["onClick"],Lt={class:"inline-block"},It={key:1,class:"text-gray-500 ml-1"},Dt={key:1,class:"p-3 mt-3 border-t border-t-neutral"},Ft={class:"text-sm italic grow whitespace-nowrap"},Wt={name:"EditGroup"},Nt=ie({...Wt,props:{group:{},isNuclearOptionEnabled:{type:Boolean}},setup(o){const s=o,l=Ze(),v=De(),{mutate:h}=st(),{mutate:i}=ye(),g=Fe(),{data:B}=nt(),{deviceGroup:M}=qe(Re()),{isDefaultGroup:r,parsedAllowedTime:$}=it(s.group),f=W(""),_=W(!1),C=W(0),E=W(0),S=W(),w=W([]),O=he(),F=d(()=>O.isShowLimitedSettings),z=d(()=>{const e=ne(s.group.dailyLimitDuration);return f.value!=s.group.customLimitName||C.value!=e.hours||E.value!=e.minutes}),u=d(()=>s.group.dailyLimitDuration==0),y=d(()=>s.group.timeLeftMs<=L.Second),Z=d(()=>!y.value&&!F.value),j=d(()=>(!y.value||u.value)&&!F.value),U=d(()=>!r.value&&!(y.value||s.group.dailyLimitDuration<L.Second)&&!F.value),we=d(()=>!s.isNuclearOptionEnabled&&(!y.value||u.value)&&!F.value),ke=d(()=>!(f.value==""||!z.value)),J=d(()=>C.value*L.Hour+E.value*L.Minute),X=d(()=>{if(!S.value||!B.value)return[];let e=[];return w.value.forEach(m=>{const I=B.value.find(A=>A.brand_id==m);I&&e.push(I.name)}),S.value.forEach(m=>{e.push(m)}),e});function oe(e){return M.value?e.includes("/")||e.includes("*"):!1}const Se=d(()=>M.value?Object.keys(X.value).some(e=>oe(e)):!1);f.value=s.group.customLimitName,S.value=s.group.websiteUrls,w.value=s.group.brandIds??[],_.value=s.group.isEnabled,C.value=$.value.hours,E.value=$.value.minutes;function Ae(e){e.target.value>23&&(C.value=23)}function Ge(e){e.target.value>59&&(E.value=59)}async function Me(){if(s.group.customLimitName!=f.value&&g.isExist(f.value)){l.error(t("groupIsAlreadyUse"));return}Te(s.group.dailyLimitDuration,s.group.elapsedTimeMs,J.value,!1)&&(P(),l.success(t("groupSaved",s.group.customLimitName)))}function P(){h({timerId:s.group.id,type:N.Group,name:f.value,allowedTimeInMs:J.value,blocklist:S.value??[],isEnabled:_.value,brandIds:w.value??[]})}const Be=Je();function Ee(){Be.show({title:t("deleteBlockedGroup"),message:t("areYouSureDeleteGroup",s.group.customLimitName),positiveButtonText:t("deleteGroup"),destructive:!0,onClickPositive(){return i({timerId:s.group.id,type:N.Group}),!0},negativeButtonText:t("cancel")})}function Ce(){v.show({addWebsites:Ie})}async function Le(e){var m;S.value=(m=S.value)==null?void 0:m.filter(I=>!e.includes(I)),le(e),P(),me.track("DELETE_WEBSITE_FROM_BLOCKED_GROUP")}function Ie(e){var m;S.value=(m=S.value)==null?void 0:m.concat(e),le(),P()}function le(e=void 0){var I;if(X.value.length==0||!B.value){w.value=[];return}if(e){const A=B.value.find(k=>k.websites.includes(e)||k.name==e);A&&w.value.find(k=>k==A.brand_id)&&(w.value=w.value.filter(k=>k!=A.brand_id))}let m=[];(I=S.value)==null||I.forEach(A=>{const k=B.value.find(b=>b.websites.includes(A));k&&(m.push(A),w.value.find(b=>b==k.brand_id)||(w.value=w.value.concat(k.brand_id.toString())))}),m.forEach(A=>{S.value=S.value.filter(k=>k!=A)})}return(e,m)=>{const I=re,A=te,k=We;return p(),T("div",{class:"border border-neutral mt-4 rounded-md overflow-x-hidden",name:"blockedGroupElement","data-testid":f.value},[n("div",ot,[n("div",lt,[D(I,{"allowed-time":J.value,"elapsed-time":e.group.elapsedTimeMs,"data-testid":"maxTimeAllowedInHoursForAllView"},null,8,["allowed-time","elapsed-time"]),e.group.isSynced&&!F.value?(p(),T("div",rt,[x(n("input",{type:"checkbox",class:"toggle toggle-sm toggle-primary","onUpdate:modelValue":m[0]||(m[0]=b=>_.value=b),onChange:P},null,544),[[be,_.value]]),n("label",ut,c(_.value?("t"in e?e.t:a(t))("active"):("t"in e?e.t:a(t))("paused")),1)])):G("",!0)]),n("div",dt,[n("div",ct,[n("div",mt,[n("span",null,c(("t"in e?e.t:a(t))("name")),1)]),n("div",pt,[x(n("input",{disabled:a(r)||!Z.value,"onUpdate:modelValue":m[1]||(m[1]=b=>f.value=b),class:"input input-bordered join-item w-full",placeholder:("t"in e?e.t:a(t))("groupName")},null,8,vt),[[H,f.value]])])]),n("div",ft,[n("p",bt,c(("t"in e?e.t:a(t))("maxTimeAllowedPerDay")),1),n("div",ht,[n("div",_t,[x(n("input",{type:"number",min:"0","onUpdate:modelValue":m[2]||(m[2]=b=>C.value=b),disabled:!j.value,onInput:Ae,"data-testid":"maxTimeAllowedInHoursForAllSites",class:"input input-bordered input-sm w-20"},null,40,yt),[[H,C.value]]),n("span",Tt,c(("t"in e?e.t:a(t))("hr")),1),x(n("input",{type:"number",min:"0",max:"59",disabled:!j.value,onInput:Ge,"onUpdate:modelValue":m[3]||(m[3]=b=>E.value=b),"data-testid":"maxTimeAllowedInMinutesForAllSites",class:"input input-bordered input-sm w-20"},null,40,gt),[[H,E.value]]),n("span",wt,c(("t"in e?e.t:a(t))("min")),1)])])]),y.value&&!u.value?(p(),V(A,{key:0,type:"error"},{default:K(()=>[q(c(("t"in e?e.t:a(t))("timeExpiredForGroup",[f.value])),1)]),_:1})):G("",!0),y.value&&u.value?(p(),V(A,{key:1,type:"error"},{default:K(()=>[q(c(("t"in e?e.t:a(t))("completelyBlockedGroup",[f.value])),1)]),_:1})):G("",!0),j.value?(p(),T("button",{key:2,class:"btn btn-primary btn-sm mt-3 ms-3","data-testid":"saveTimeForAllWebsitesBtn",onClick:Me,disabled:!ke.value},c(("t"in e?e.t:a(t))("saveChanges")),9,kt)):G("",!0),U.value?(p(),T("button",{key:3,onClick:Ee,class:"btn btn-outline btn-error btn-sm mt-3 not-prose float-right uppercase"},[D(a(Ye),{class:"h-5 w-5 align-text-bottom"}),q(" "+c(("t"in e?e.t:a(t))("deleteGroup")),1)])):G("",!0)])]),a(r)?G("",!0):(p(),V(k,{key:0,"is-share":e.group.isSynced,"group-id":e.group.id},null,8,["is-share","group-id"])),n("div",St,[n("div",At,[n("p",Gt,c(("t"in e?e.t:a(t))("blockedWebsites")),1),n("button",{class:"btn btn-sm btn-primary btn-outline uppercase shrink flex-nowrap justify-start whitespace-nowrap overflow-hidden text-ellipsis",onClick:Ce,"data-testid":"add-websites-btn"},[D(a(Qe),{class:"h-5 w-5 shrink-0 inline"}),q(" "+c(("t"in e?e.t:a(t))("addBlockedWebsites")),1)])]),n("div",Mt,[n("ul",Bt,[(p(!0),T(Q,null,ce(X.value,b=>(p(),T("li",{key:b},[n("div",Et,[we.value?(p(),T("button",{key:0,class:"btn btn-sm btn-ghost btn-circle mr-2",onClick:os=>Le(b)},[D(a(Pe),{class:"h-4 w-4 cursor-pointer align-middle text-error inline-block","data-url":"website"})],8,Ct)):G("",!0),D(ze,{"app-id":b,"app-name":b,size:24,class:"icon inline-block mr-2 align-middle w-6 h-6 my-1"},null,8,["app-id","app-name"]),n("p",Lt,c(b),1),e.group.isSynced&&oe(b)?(p(),T("p",It," * ")):G("",!0)])]))),128))])])]),Se.value?(p(),T("div",Dt,[n("p",Ft,c(("t"in e?e.t:a(t))("wildcardsPathsNotSupported")),1)])):G("",!0)],8,at)}}}),$t=_e(Nt,[["__scopeId","data-v-b3fdbe97"]]);function Ot(){const o=Y();return de({queryKey:[R.GetTimerForBlockAll],queryFn:()=>o.timers.getTimerById(N.BlockAll),refetchOnMount:!0,refetchOnReconnect:!0,refetchOnWindowFocus:!0})}function ge(){const{data:o}=Ot(),s=d(()=>o.value?o.value.timeLeftMs<L.Second?1:o.value.timeLeftMs:1),l=d(()=>o.value!=null),{state:v}=pe(ve),h=d(()=>o.value?o.value.timer.allowedTimeMs:v.value),i=d(()=>h.value-s.value),g=d(()=>s.value==0);return{isEnable:l,allowedTime:h,elapsedTime:i,remainingTime:s,isTimeExpired:g}}function Ut(){const o=Y(),s=se();return ae({mutationFn:async({timer:l,allowedTimeInMs:v})=>{const h=fe(l,i=>{i.allowedTimeMs=v});await o.timers.upsertTimer(h)},onSuccess:()=>{s.invalidateQueries({queryKey:[R.GetTimerForBlockAll]})}})}const xt={class:"cursor-pointer label justify-start mt-2",id:"blockAllWebsites"},qt=["disabled"],Rt={class:"label-text"},Vt={key:0,class:"flex flex-row p-3"},jt={class:"pl-3 grow m-auto"},Ht={class:"inline-block whitespace-nowrap"},Kt={class:"join"},Pt={class:"ml-3"},Qt=["disabled"],Yt={class:"rounded-none mx-2"},zt=["disabled"],Zt={class:"rounded-none mx-2"},Jt={name:"BlockAllWebsites"},Xt=ie({...Jt,setup(o){const{isEnable:s,allowedTime:l,elapsedTime:v,isTimeExpired:h}=ge(),{mutate:i}=ye(),{mutate:g}=Ut(),{state:B}=pe(ve),M=W(0),r=W(0);w(l.value),Ve(l,u=>{w(u)});const $=he(),f=d(()=>$.isShowLimitedSettings),_=d(()=>!(h.value||f.value));async function C(){s.value?i({timerId:ee,type:N.BlockAll}):(F(),me.track("BLOCK_ALL_WEBSITES"))}function E(u){u.target.value>23&&(M.value=23)}function S(u){u.target.value>59&&(r.value=59)}function w(u){const y=ne(u);M.value=y.hours,r.value=y.minutes}const O=d(()=>M.value*L.Hour+r.value*L.Minute);function F(){g({timer:{id:ee,name:ee,type:N.BlockAll,allowedTimeMs:O.value,isEnabled:!0,isSynced:!1},allowedTimeInMs:O.value}),B.value=O.value}async function z(){Te(l.value,v.value,O.value,!0)?F():w(l.value)}return(u,y)=>{const Z=re,j=te;return p(),T(Q,null,[n("label",xt,[x(n("input",{type:"checkbox",onClick:C,"onUpdate:modelValue":y[0]||(y[0]=U=>je(s)?s.value=U:null),disabled:f.value,"data-testid":"blockAllSites",class:"checkbox checkbox-sm checkbox-primary mr-2"},null,8,qt),[[be,a(s)]]),n("span",Rt,c(("t"in u?u.t:a(t))("blockAllwebsitesDescription")),1)]),a(s)?(p(),T("div",Vt,[D(Z,{"allowed-time":O.value,"elapsed-time":a(v),"data-testid":"maxTimeAllowedInHoursForAllView"},null,8,["allowed-time","elapsed-time"]),n("div",jt,[n("p",Ht,c(("t"in u?u.t:a(t))("maxTimeAllowedPerDay")),1),n("div",Kt,[n("div",Pt,[x(n("input",{type:"number",min:"0","onUpdate:modelValue":y[1]||(y[1]=U=>M.value=U),disabled:!_.value,onInput:E,"data-testid":"maxTimeAllowedInHoursForAllSites",class:"input input-bordered input-sm w-20"},null,40,Qt),[[H,M.value]]),n("span",Yt,c(("t"in u?u.t:a(t))("hr")),1),x(n("input",{type:"number",min:"0",max:"59",disabled:!_.value,onInput:S,"onUpdate:modelValue":y[2]||(y[2]=U=>r.value=U),"data-testid":"maxTimeAllowedInMinutesForAllSites",class:"input input-bordered input-sm w-20"},null,40,zt),[[H,r.value]]),n("span",Zt,c(("t"in u?u.t:a(t))("min")),1)])]),a(h)?(p(),V(j,{key:0,type:"error"},{default:K(()=>[q(c(("t"in u?u.t:a(t))("timeExpiredCannotChangeUntilTomorrow")),1)]),_:1})):G("",!0),_.value?(p(),T("button",{key:1,class:"btn btn-primary btn-sm mt-3","data-testid":"saveTimeForAllWebsitesBtn",onClick:z},c(("t"in u?u.t:a(t))("saveChanges")),1)):G("",!0)])])):G("",!0)],64)}}}),es={class:"flex flex-row justify-between mt-4 items-center"},ts={class:"font-bold text-lg"},ss=ie({__name:"BlockedSitesAndGroups",setup(o){const s=Ne(),{groups:l}=He(!0),{mutate:v}=et(),{data:h}=Xe(),{isEnable:i}=ge(),g=d(()=>!!h.value);function B(){s.show({saveGroup:M})}function M(r){v({timer:{id:r.id,name:r.customLimitName??"",allowedTimeMs:r.dailyLimitDuration,type:N.Group,blocklist:r.websiteUrls,brandIds:r.brandIds,isEnabled:!0,isSynced:r.isSynced}})}return(r,$)=>{const f=Xt,_=te,C=$t;return p(),T(Q,null,[n("p",null,c(("t"in r?r.t:a(t))("blockedSitesHeader")),1),D(f),n("div",{class:Ke({"pointer-events-none opacity-50":a(i)})},[n("div",es,[n("p",ts,c(("t"in r?r.t:a(t))("groups")),1),n("button",{class:"btn btn-primary btn-sm",onClick:B},c(("t"in r?r.t:a(t))("addGroup")),1)]),a(g)?(p(),V(_,{key:0,type:"error"},{default:K(()=>[q(c(("t"in r?r.t:a(t))("cannotRemoveBlockedSiteDuringNuclearOption")),1)]),_:1})):G("",!0),(p(!0),T(Q,null,ce(a(l),E=>(p(),V(C,{key:E.id,group:E,"is-nuclear-option-enabled":a(g)},null,8,["group","is-nuclear-option-enabled"]))),128))],2)],64)}}}),ns={},is={class:"flex flex-col"};function as(o,s){const l=tt,v=ss;return p(),T("div",is,[D(l,null,{default:K(()=>[q(c(("t"in o?o.t:a(t))("blockedSites")),1)]),_:1}),D(v)])}const As=_e(ns,[["render",as]]);export{As as default};
