import{a1 as v,d9 as I,W as w,da as D,db as C,dc as M,dd as k,de as U,ae as F,am as L,ap as y,aG as _,ay as V,ax as o,aw as N,aA as r,af as s,G as l,az as g,df as O,aJ as T,aI as h,av as R}from"./_virtual_wxt-plugins-CgS_BGdF.js";import{i as A}from"./migration-BnBTkseb.js";import{_ as B}from"./HeaderItem-B9YPjTpp.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";async function $(){function a(n,f){const E={mm:n.getMonth()+1,dd:n.getDate(),yyyy:n.getFullYear()};return f.replace(/yyyy|mm|dd/gi,b=>E[b].toString())}function c(n,f,E){const b=new Blob([n],{type:f}),S=document.createElement("a");S.download=E,S.href=window.URL.createObjectURL(b),S.style.display="none",document.body.appendChild(S),S.click()}const e=`StayFocusd_${a(new Date,"yyyy-mm-dd")}.json`;v("exportSettings","Export settings",e);const u=await I.getValue(),p=await w.snapshot("local"),t=await w.snapshot("sync"),m={};D.forEach(n=>{p[n]&&(m[n]=p[n])});const d={};u?C.forEach(n=>{p[n]&&(d[n]=p[n])}):C.forEach(n=>{t[n]&&(d[n]=t[n])});const i=M({LOCAL:m},{SYNC:d});c(JSON.stringify(i),"application/json",e)}const j=8192;async function G(a){const c=e=>new Promise((u,p)=>{const t=new FileReader;t.onloadend=m=>{var d;return u((d=m.target)==null?void 0:d.result)},t.onerror=p,v("importSettings","Importing settings",e),t.readAsText(e)});try{v("importSettings","Import settings",a);const e=await c(a),u=P(e),p=u.LOCAL,t={},m={};if(D.forEach(i=>{p[i]&&(t[i]=p[i])}),!await I.getValue()){const i=u.SYNC;let n=!1;C.forEach(f=>{i[f]&&(JSON.stringify(i[f]).length>j?(t[f]=i[f],n=!0):m[f]=i[f])}),n&&await I.setValue(!0)}for(const i of k)await i.removeMeta(["v"]);await w.restoreSnapshot("local",t),await w.restoreSnapshot("sync",m);for(const i of k)await i.migrate();return A(),!0}catch(e){return U("Save imported settings",e.message),!1}}function P(a){try{return JSON.parse(decodeURIComponent(a))}catch{return JSON.parse(a)}}const Y={key:0,class:"mt-3"},z={class:"text-success font-bold uppercase"},Q={key:1,class:"mt-3"},W={class:"text-error"},q={class:"mt-3"},H={class:"mt-3"},K=F({__name:"ImportSettings",setup(a){const c=L(),e=L(),u=`mailto:${O()}?subject=Error%20importing%20settings`;async function p(){var d;T.track("IMPORT_SETTINGS"),e.value=void 0;const t=(d=c.value)==null?void 0:d.files;if(!t||t.length===0)return alert(l("mustSelectSettingsFile")),!1;const m=await G(t[0]);e.value=m,m&&(c.value.value="",T.track("IMPORT_SETTINGS_SUCCESSFUL"))}return(t,m)=>(_(),y(V,null,[o("p",null,r(("t"in t?t.t:s(l))("importSettingsDescription")),1),o("input",{type:"file",ref_key:"fileInput",ref:c,class:"file-input file-input-bordered w-full mt-3",name:"settings",size:"40"},null,512),o("div",null,[o("button",{class:"btn btn-primary btn-sm mt-3 uppercase",onClick:p},r(("t"in t?t.t:s(l))("importSettings")),1)]),s(e)==!0?(_(),y("div",Y,[o("p",z,r(("t"in t?t.t:s(l))("done")),1)])):N("",!0),s(e)==!1?(_(),y("div",Q,[o("p",W,r(("t"in t?t.t:s(l))("problemImportingSettings")),1),o("p",q,[g(r(("t"in t?t.t:s(l))("importEmailSupport1"))+" ",1),o("a",{class:"link",href:u},r(("getSupportEmail"in t?t.getSupportEmail:s(O))()),1),g(" "+r(("t"in t?t.t:s(l))("importEmailSupport2")),1)])])):N("",!0),o("p",H,[o("small",null,[g(r(("t"in t?t.t:s(l))("importingSettingsOverwrite1"))+" ",1),o("b",null,r(("t"in t?t.t:s(l))("overwrite")),1),g(" "+r(("t"in t?t.t:s(l))("importingSettingsOverwrite2")),1)])])],64))}}),X=F({__name:"ExportSettings",setup(a){async function c(){await $()}return(e,u)=>(_(),y(V,null,[o("p",null,r(("t"in e?e.t:s(l))("exportSettingsDescription")),1),o("div",null,[o("button",{class:"btn btn-primary btn-sm mt-3 uppercase",onClick:c},r(("t"in e?e.t:s(l))("exportSettings")),1)])],64))}}),Z={},x={class:"flex flex-col"};function tt(a,c){const e=B,u=X,p=K;return _(),y("div",x,[h(e,null,{default:R(()=>[g(r(("t"in a?a.t:s(l))("exportSettings")),1)]),_:1}),h(u),c[0]||(c[0]=o("hr",{class:"mb-4 mt-7"},null,-1)),h(e,null,{default:R(()=>[g(r(("t"in a?a.t:s(l))("importSettings")),1)]),_:1}),h(p)])}const at=J(Z,[["render",tt]]);export{at as default};
